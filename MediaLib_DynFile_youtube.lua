local a=medialib.load("oop")local b=a.class("YoutubeService","HTMLService")b.identifier="youtube"local c={"^https?://[A-Za-z0-9%.%-]*%.?youtu%.be/([A-Za-z0-9_%-]+)","^https?://[A-Za-z0-9%.%-]*%.?youtube%.com/watch%?.*v=([A-Za-z0-9_%-]+)","^https?://[A-Za-z0-9%.%-]*%.?youtube%.com/v/([A-Za-z0-9_%-]+)"}local d={}for e,f in pairs(c)do local function g(h)table.insert(d,f..h.."t=(%d+)m(%d+)s")table.insert(d,f..h.."t=(%d+)s?")end;g("#")g("&")g("?")table.insert(d,f)end;function b:parseUrl(i)for e,j in pairs(d)do local k,l,m=string.match(i,j)if k then local n;if l and m then n=tonumber(l)*60+tonumber(m)else n=tonumber(l)end;return{id=k,start=n}end end end;function b:isValidUrl(i)return self:parseUrl(i)~=nil end;local o="http://wyozi.github.io/gmod-medialib/youtube.html?id=%s"function b:resolveUrl(i,p)local q=self:parseUrl(i)local r=string.format(o,q.id)p(r,{start=q.start})end;local function s(t)local u=t:match("(%d+)H")or 0;local v=t:match("(%d+)M")or 0;local w=t:match("(%d+)S")or 0;return u*60*60+v*60+w end;local x="AIzaSyBmQHvMSiOTrmBKJ0FFJ2LmNtc4YHyUJaQ"function b:directQuery(i,p)local y=medialib.YOUTUBE_API_KEY or x;local q=self:parseUrl(i)local z=string.format("https://www.googleapis.com/youtube/v3/videos?part=snippet%%2CcontentDetails&id=%s&key=%s",q.id,y)http.Fetch(z,function(A,B)if B==0 then p("http body size = 0")return end;local C={}C.id=q.id;local D=util.JSONToTable(A)if D and D.items then local E=D.items[1]if not E then p("No video id found")return end;C.title=E.snippet.title;local F=E.snippet.liveBroadcastContent=="live"if F then C.live=true else C.duration=tonumber(s(E.contentDetails.duration))end;C.raw=E else p(A)return end;p(nil,C)end,function(G)p("HTTP: "..G)end)end;function b:hasReliablePlaybackEvents()return true end;return b
